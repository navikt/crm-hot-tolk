<template>
    <template lwc:if={hasResult}>
        <div class="main-content">
            <c-hot_freelance-common-table
                records={records}
                columns={columns}
                onrowclick={goToRecordDetails}
            ></c-hot_freelance-common-table>
        </div>
    </template>

    <template lwc:elseif={noServiceAppointmentsResult}>
        <div style="text-align: center">
            <br />
            <p>Du har ingen kommende oppdrag.</p>
            <br />
        </div>
    </template>

    <template lwc:elseif={noFilteredRecordsResult}>
        <div style="text-align: center">
            <br />
            <p>Det finnes ingen oppdrag med denne filtreringen. Du kan endre filteret for å se andre oppdrag</p>
            <br />
        </div>
    </template>
    <template lwc:if={dataLoader}>
        <div class="loader-container">
            <c-hot_loader size="3xlarge"></c-hot_loader>
        </div>
    </template>
    <!-- MODAL -->
    <dialog class="modal-container" aria-label="Informasjon om oppdrag" aria-modal="true" onclose={closeModal}>
        <div class="modal-header">
            <h2>Informasjon om oppdraget:</h2>
            <button class="close-btn" onclick={closeModal} aria-label="Lukk">
                <img src={exitCrossIcon} alt="" aria-hidden="true" />
            </button>
        </div>
        <template lwc:if={hasAccess}>
            <div class="modal-body">
                <div lwc:if={isDetails}>
                    <p><strong>Oppdragsnummer:</strong> {appointmentNumber}</p>
                    <p><strong>Tema:</strong> {subject}</p>
                    <p><strong>Tid:</strong> {startAndEndTime}</p>

                    <p lwc:if={address}><strong>Adresse:</strong> {address}</p>

                    <div
                        lwc:if={serviceAppointment.HOT_AddressFormated__c}
                        style="display: inline-block; padding-right: 1vw"
                    >
                        <p aria-hidden="true"><strong>Søk på adressen i en karttjeneste:</strong></p>
                        <div style="display: inline-block; padding-right: 1vw; padding-bottom: 1vw; padding-top: 1vw">
                            <c-button
                                button-styling="secondary"
                                button-label="Google maps"
                                onbuttonclick={openGoogleMaps}
                                aria-label="Åpne adressen i Google maps"
                                mobile-style="margin-top: 0.5rem; margin-bottom: 0.5rem"
                            ></c-button>
                        </div>
                        <div style="display: inline-block; padding-right: 1vw; padding-bottom: 1vw; padding-top: 1vw">
                            <c-button
                                button-styling="secondary"
                                button-label="Apple maps"
                                onbuttonclick={openAppleMaps}
                                aria-label="Åpne adressen i Apple maps"
                                mobile-style="margin-top: 0.5rem; margin-bottom: 0.5rem"
                            ></c-button>
                        </div>
                    </div>

                    <p lwc:if={actualStartTime}><strong>Faktisk start:</strong> {actualStartTime}</p>
                    <p lwc:if={actualEndTime}><strong>Faktisk slutt:</strong> {actualEndTime}</p>

                    <p lwc:if={accountName}><strong>Navn til bruker:</strong> {accountName} ({accountAgeGender})</p>

                    <p lwc:if={accountPhoneNumber}><strong>Telefonnummer til bruker:</strong> {accountPhoneNumber}</p>

                    <p><strong>Tolkemetode:</strong> {workType}</p>
                    <p><strong>Oppdragstype:</strong> {assignmentType}</p>
                    <p><strong>Eier:</strong> {ownerName}</p>
                    <p><strong>Status:</strong> {status}</p>
                    <p><strong>Haptisk kommunikasjon:</strong> {hapticCommunication}</p>

                    <p lwc:if={escort}><strong>Ledsaging:</strong> {escort}</p>

                    <p lwc:if={degreeOfHearingAndVisualImpairment}>
                        <strong>Vedtak:</strong> {degreeOfHearingAndVisualImpairment}
                    </p>

                    <p lwc:if={showTermsOfAgreement}><strong>Avtalte betingelser:</strong> {showTermsOfAgreement}</p>

                    <p lwc:if={interpreters}><strong>(Med)tolk:</strong> {interpreters}</p>

                    <p lwc:if={description}><strong>Tilleggsopplysninger:</strong> {description}</p>

                    <p lwc:if={showOrdererPhoneNumber}>
                        <strong>Telefonnummer til bestiller:</strong> {showOrdererPhoneNumber}
                    </p>

                    <p><strong>Annen betaler:</strong> {isOtherProvider}</p>

                    <p lwc:if={dispatcher}><strong>Formidler:</strong> {dispatcher}</p>

                    <div class="files-container">
                        <c-record-files-with-sharing
                            record-id={serviceAppointment.Id}
                            is-get-all="true"
                            is-delete-option="false"
                            title="Vedlegg"
                            delete-file-on-button-click="false"
                        ></c-record-files-with-sharing>
                    </div>
                    <div class="button-container">
                        <c-button
                            disabled={isEditButtonDisabled}
                            hidden={isEditButtonHidden}
                            onbuttonclick={changeStatus}
                            button-styling="Primary"
                            type="Submit"
                            button-label="Endre status"
                            aria-label="Endre status på oppdraget"
                            mobile-style="margin-top: 1rem; margin-bottom: 1rem"
                        >
                        </c-button>

                        <c-button
                            hidden={isCancelButtonHidden}
                            onbuttonclick={cancelStatusFlow}
                            button-styling="Secondary"
                            type="Submit"
                            button-label="Avbryt"
                            aria-label="Avbryt endring av status"
                            mobile-style="margin-top: 1rem; margin-bottom: 1rem"
                        >
                        </c-button>
                    </div>
                    <div lwc:if={isflow} class="flow-container">
                        <lightning-flow
                            flow-api-name="HOT_ChangeServiceAppointmentStatus_V1"
                            flow-input-variables={flowVariables}
                            onstatuschange={handleStatusChange}
                        ></lightning-flow>
                    </div>
                    <p aria-hidden="true">Samtale med:</p>
                    <div class="button-container">
                        <c-button
                            button-styling="Primary"
                            type="Submit"
                            onbuttonclick={goToThreadFreelance}
                            button-label="Bruker"
                            aria-label="Gå til samtale med bruker"
                            disabled={isGoToThreadButtonDisabled}
                            mobile-style="margin-top: 1rem"
                        >
                        </c-button>
                    </div>
                    <div class="button-container">
                        <c-button
                            button-styling="Primary"
                            type="Submit"
                            onbuttonclick={goToThreadInterpreters}
                            disabled={isGoToThreadInterpretersButtonDisabled}
                            aria-label="Gå til samtale med medtolk"
                            button-label="Medtolker"
                            mobile-style="margin-top: 1rem"
                        >
                        </c-button>
                    </div>
                    <div class="button-container">
                        <c-button
                            button-styling="Primary"
                            type="Submit"
                            onbuttonclick={goToThreadServiceAppointment}
                            button-label="Formidler"
                            aria-label="Gå til samtale med formidler"
                            disabled={isGoToThreadServiceAppointmentButtonDisabled}
                            mobile-style="margin-top: 1rem"
                        >
                        </c-button>
                    </div>
                </div>
            </div>
        </template>
        <template lwc:else>
            <div class="modal-body">
                <p>Du er ikke tildelt oppdraget lenger.</p>
            </div>
        </template>
    </dialog>
</template>
