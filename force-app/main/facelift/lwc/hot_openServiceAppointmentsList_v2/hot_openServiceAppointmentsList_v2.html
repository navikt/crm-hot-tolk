<template>
    <template lwc:if={hasResult}>
        <div class="main-content">
            <c-hot_freelance-common-table
                records={records}
                columns={columns}
                onrowclick={goToRecordDetails}
                checkbox="true"
                checked-rows={checkedServiceAppointments}
                oncheckedrows={handleRowChecked}
                icon-by-value={iconByValue}
            >
            </c-hot_freelance-common-table>
        </div>
    </template>

    <template lwc:elseif={noServiceAppointmentsResult}>
        <div style="text-align: center">
            <br />
            <p>Det er ingen ledige oppdrag.</p>
            <br />
        </div>
    </template>

    <template lwc:elseif={noFilteredRecordsResult}>
        <div style="text-align: center">
            <br />
            <p>Det er ingen oppdrag med denne filtreringen. Du kan endre filteret for å se andre oppdrag</p>
            <br />
        </div>
    </template>
    <template lwc:if={dataLoader}>
        <div class="loader-container">
            <c-hot_loader size="3xlarge"></c-hot_loader>
        </div>
    </template>

    <div lwc:if={showSendInterest} class="meld-interesse-overlay">
        <div class="meld-interesse-content">
            <c-button
                button-styling="primary"
                button-label={sendInterestButtonLabel}
                aria-label="Meld interesse"
                onbuttonclick={sendInterest}
                desktop-style=" justify-content: center; border-radius: 0.25rem;"
                mobile-style="justify-content: center; border-radius: 0.25rem;"
                title="Merk sjekkboks i listen for å melde interesse"
            >
            </c-button>
        </div>
    </div>
    <!-- MODALER -->
    <dialog class="modal-container" aria-label="Informasjon om oppdrag" aria-modal="true" onclose={closeModal}>
        <!-- MODAL SOM VISES NÅR MAN TRYKKER MELD INTERESSE-->
        <div lwc:if={showCommentsModal}>
            <div class="modal-header" lwc:if={showModalHeader}>
                <h2>Legg inn kommentarer til oppdragene:</h2>
                <button class="close-btn" onclick={closeModal} aria-label="Lukk">
                    <img src={exitCrossIcon} alt="" aria-hidden="true" />
                </button>
            </div>
            <div class="modal-body">
                <div lwc:if={showCommentSectionDetails}>
                    <template iterator:it={serviceAppointmentCommentDetails}>
                        <lightning-record-edit-form
                            class="comment-form"
                            key={it.value.Id}
                            object-api-name="HOT_InterestedResource__c"
                            density="comfy"
                        >
                            <p><strong>Tema:</strong> {it.value.HOT_FreelanceSubject__c}</p>
                            <p><strong>Tid:</strong> {it.value.StartAndEndDate}</p>
                            <p><strong>Adresse:</strong> {it.value.HOT_AddressFormated__c}</p>
                            <p><strong>Tolkemetode:</strong> {it.value.HOT_WorkTypeName__c}</p>
                            <p><strong>Oppdragstype:</strong> {it.value.HOT_AssignmentType__c}</p>
                            <p><strong>Frigitt av:</strong> {it.value.HOT_ReleasedBy__c}</p>
                            <p><strong>Frigitt dato:</strong> {it.value.ReleaseDate}</p>
                            <p><strong>Antall påmeldte:</strong> {it.value.HOT_NumberOfInterestedResources__c}</p>
                            <p><strong>Annen betaler:</strong> {it.isOtherProvider}</p>
                            <p><strong>Region:</strong> {it.value.HOT_ServiceTerritoryName__c}</p>
                            <p><strong>Frist dato:</strong> {it.value.HOT_DeadlineDate__c}</p>
                            <label for="Comments__c">Start samtale med formidler</label>
                            <lightning-input-field
                                class="ikke-sensitive-opplysninger comment-field"
                                field-name="Comments__c"
                                variant="label-hidden"
                            ></lightning-input-field>
                        </lightning-record-edit-form>
                    </template>
                </div>

                <div class="submit">
                    <div lwc:if={showSubmittedTrue} class="submitted-true">
                        <lightning-icon
                            icon-name="utility:success"
                            alternative-text="Suksess"
                            title="Suksess"
                            variant="success"
                            size="large"
                        ></lightning-icon>
                        <br />
                        <h2
                            class="typo-undertittel h2-successMessage"
                            id="successMessage"
                            tabindex="-1"
                            role="alert"
                            aria-live="polite"
                        >
                            Interesse er meldt.
                        </h2>
                        <br />
                        <c-button
                            button-styling="primary"
                            button-label="OK"
                            onbuttonclick={closeModal}
                            desktop-style="width: 8rem; justify-content: center"
                            mobile-style="width: 8rem; justify-content: center"
                        ></c-button>
                    </div>

                    <div lwc:if={showSubmittedLoading} class="submitted-loading">
                        <h2
                            class="typo-undertittel h2-loadingMessage"
                            id="loadingMessage"
                            tabindex="-1"
                            role="alert"
                            aria-live="polite"
                        >
                            Melder interesse...
                        </h2>
                        <br />
                        <div lwc:if={spin}>
                            <c-hot_loader size="3xlarge" variant="interaction"></c-hot_loader>
                        </div>
                        <br />
                    </div>

                    <div lwc:if={showSubmittedError} class="submitted-error">
                        <h2
                            class="typo-undertittel h2-loadingMessage"
                            id="errorMessage"
                            tabindex="-1"
                            role="alert"
                            aria-live="polite"
                        >
                            Noe gikk galt under melding av interesse.
                        </h2>
                        <br />
                        <h3>Feilmelding: {errorMessage}</h3>
                        <br />
                    </div>
                </div>

                <c-button
                    lwc:if={showSendInnBtn}
                    class="send-inn-button"
                    button-styling="primary"
                    button-label="Send inn"
                    type="submit"
                    onbuttonclick={registerInterest}
                    desktop-style="width: 8rem; justify-content: center"
                    mobile-style="width: 8rem; justify-content: center"
                ></c-button>
            </div>
        </div>
        <!-- MODAL SOM VISES NÅR MAN TRYKKER PÅ OPPDRAG (IKKE NÅR MAN TRYKKER "MELD INTERESSE..")-->
        <div lwc:if={showServiceAppointmentDetailsModal}>
            <div class="modal-header">
                <h2>Informasjon om oppdraget:</h2>
                <button class="close-btn" onclick={closeModal} aria-label="Lukk">
                    <img src={exitCrossIcon} alt="" aria-hidden="true" />
                </button>
            </div>
            <div lwc:if={isDetails} class="modal-body">
                <p><strong>Oppdragsnummer:</strong> {serviceAppointment.HOT_ServiceAppointmentNumber__c}</p>
                <p><strong>Tema:</strong> {serviceAppointment.HOT_FreelanceSubject__c}</p>
                <p><strong>Tid:</strong> {serviceAppointment.weekday} {serviceAppointment.StartAndEndDate}</p>
                <p><strong>Adresse:</strong> {serviceAppointment.HOT_AddressFormated__c}</p>
                <p><strong>Tolkemetode:</strong> {serviceAppointment.HOT_WorkTypeName__c}</p>
                <p><strong>Oppdragstype:</strong> {serviceAppointment.HOT_AssignmentType__c}</p>
                <p><strong>Frigitt av:</strong> {serviceAppointment.HOT_ReleasedBy__c}</p>
                <p><strong>Frigitt dato:</strong> {serviceAppointment.ReleaseDate}</p>
                <p><strong>Antall påmeldte:</strong> {serviceAppointment.HOT_NumberOfInterestedResources__c}</p>
                <p><strong>Annen betaler:</strong> {serviceAppointment.isOtherProvider}</p>
                <p><strong>Eier:</strong> {serviceAppointment.HOT_Request__r.OwnerName__c}</p>
                <p><strong>Frist dato:</strong> {serviceAppointment.HOT_DeadlineDate__c}</p>
                <br />
                <div lwc:if={isSeries}>
                    <c-button
                        button-styling="primary"
                        button-label="Meld interesse til alle oppdrag i serien"
                        aria-label="Meld interesse til alle oppdrag i serien"
                        onbuttonclick={sendInterestSeries}
                        desktop-style="width: 20rem; justify-content: center; margin-bottom:2rem;"
                        mobile-style="width: 100%; justify-content: center; margin-bottom:2rem;"
                        title="Meld interesse til alle oppdrag i serien"
                    >
                    </c-button>
                    <c-hot_freelance-common-table
                        records={seriesRecords}
                        columns={inDetailsColumns}
                        onrowclick={goToRecordDetails}
                    ></c-hot_freelance-common-table>
                </div>
            </div>
        </div>
    </dialog>
    <!-- MODALER SLUTT-->
</template>
